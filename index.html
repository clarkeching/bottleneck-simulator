<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- PWA / Add to Home Screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Bottleneck">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f5f7fa">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è≥</text></svg>">
    <link rel="manifest" href="manifest.json">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>Bottleneck Simulator</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            padding: 30px;
            max-width: 1100px;
            margin: 0 auto;
            min-height: 100vh;
        }
        h1 {
            margin: 0 0 24px 0;
            font-weight: 700;
            font-size: 28px;
            color: #1a1a2e;
            letter-spacing: -0.5px;
        }
        .controls {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        #startBtn {
            font-size: 18px;
            font-weight: 600;
            padding: 12px 28px;
            cursor: pointer;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            transition: all 0.2s ease;
        }
        #startBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
        }
        #startBtn:disabled {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }
        #stopBtn {
            font-size: 18px;
            font-weight: 600;
            padding: 12px 28px;
            cursor: pointer;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            transition: all 0.2s ease;
            display: none;
        }
        #stopBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }
        #stopBtn.visible {
            display: inline-block;
        }
        #resetBtn {
            font-size: 14px;
            font-weight: 500;
            padding: 10px 20px;
            cursor: pointer;
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            font-family: inherit;
            transition: all 0.2s ease;
        }
        #resetBtn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
        .timer {
            font-size: 22px;
            font-weight: 600;
            color: #374151;
            background: white;
            padding: 10px 18px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .costume-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #6b7280;
        }
        .costume-btn {
            font-size: 28px;
            padding: 8px 12px;
            cursor: pointer;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        .costume-btn:hover {
            border-color: #9ca3af;
            transform: scale(1.05);
        }
        .costume-btn.selected {
            border-color: #3b82f6;
            background: #eff6ff;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }
        .mute-btn {
            font-size: 22px;
            padding: 8px 14px;
            cursor: pointer;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        .mute-btn:hover {
            border-color: #9ca3af;
        }
        .mute-btn.muted {
            background: #fef2f2;
            border-color: #fca5a5;
        }
        #randomizeBtn {
            font-size: 14px;
            font-weight: 500;
            padding: 10px 20px;
            cursor: pointer;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            transition: all 0.2s ease;
        }
        #randomizeBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
        }
        #randomizeBtn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            box-shadow: none;
        }
        .options-bar {
            margin-top: 16px;
            padding: 16px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        .flow-container {
            display: grid;
            grid-template-columns: auto 1fr;
            grid-template-rows: auto auto;
            gap: clamp(6px, 1vw, 12px);
            background: white;
            padding: clamp(12px, 2vw, 24px);
            border: none;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .incoming {
            grid-column: 1;
            grid-row: 1 / 3;
            display: flex;
            align-items: flex-start;
        }
        .flow-arrow {
            font-size: clamp(14px, 1.8vw, 22px);
            flex-shrink: 0;
            padding-top: 15px;
            color: #9ca3af;
        }
        .workers-row {
            grid-column: 2;
            grid-row: 1;
            display: flex;
            gap: clamp(4px, 1vw, 10px);
            justify-content: space-around;
        }
        .worker-station {
            display: flex;
            align-items: flex-start;
        }
        .queue {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 3px;
            min-width: 40px;
            min-height: 50px;
            max-height: calc(100vh - 300px);
            overflow: hidden;
            padding: 8px;
            background: #f8fafc;
            border: 2px dashed #e2e8f0;
            border-radius: 10px;
            margin-right: 6px;
        }
        .queue-item {
            font-size: clamp(10px, 1.2vw, 14px);
        }
        .worker {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .worker-icon {
            font-size: clamp(28px, 4vw, 52px);
            padding: clamp(6px, 1vw, 14px);
            border: 3px solid #e2e8f0;
            border-radius: 14px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.2s ease;
        }
        .worker.processing .worker-icon {
            background: #fffef5;
            border-color: #e5e7eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .worker.bottleneck .worker-icon {
            border-color: #f87171;
            border-width: 3px;
            box-shadow: 0 2px 8px rgba(248, 113, 113, 0.2);
        }
        .worker-label {
            font-size: 13px;
            font-weight: 600;
            margin-top: 6px;
            color: #6b7280;
        }
        .worker.bottleneck .worker-label {
            color: #ef4444;
            font-weight: 700;
        }
        .worker-rate {
            font-size: 13px;
            color: #6b7280;
            margin-top: 2px;
            font-weight: 500;
        }
        .instructions {
            margin-top: 20px;
            color: #6b7280;
            font-size: 14px;
            line-height: 1.5;
        }
        .costume-label {
            font-size: 10px;
            color: #9ca3af;
            text-align: center;
            margin-top: 4px;
        }
        /* End of day report modal */
        .report-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .report-overlay.visible {
            display: flex;
        }
        .report-modal {
            background: white;
            padding: 32px;
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-width: 420px;
            width: 90%;
        }
        .report-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            color: #1a1a2e;
        }
        .report-section {
            margin-bottom: 15px;
        }
        .report-label {
            font-weight: 600;
            color: #6b7280;
        }
        .report-value {
            font-size: 20px;
            font-weight: 700;
        }
        .report-value.good {
            color: #22c55e;
        }
        .report-value.bad {
            color: #ef4444;
        }
        .report-breakdown {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #f3f4f6;
        }
        .report-breakdown-title {
            font-weight: 600;
            margin-bottom: 10px;
        }
        .worker-stat {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .worker-stat.bottleneck {
            color: #ef4444;
            font-weight: 600;
        }
        .report-insight {
            margin-top: 20px;
            padding: 16px;
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            border: none;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            color: #854d0e;
        }
        .report-close {
            margin-top: 24px;
            padding: 14px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            width: 100%;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            transition: all 0.2s ease;
        }
        .report-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
        }
        .done-area {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            justify-self: end;
        }
        .completed-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .completed-title {
            font-size: 11px;
            font-weight: 600;
            color: #22c55e;
            margin-bottom: 4px;
        }
        .completed-stack {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            min-width: 60px;
            max-height: calc(100vh - 300px);
            overflow: hidden;
            padding: 8px;
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border: 2px dashed #86efac;
            border-radius: 10px;
        }
        .completed-item {
            font-size: 14px;
        }
        .truck-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .truck-with-cargo {
            display: flex;
            align-items: flex-end;
            transition: transform 2.5s cubic-bezier(0.1, 0, 0.3, 1);
        }
        .truck-with-cargo.driving {
            transform: translateX(400px);
        }
        .truck-bed {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            min-width: 30px;
            min-height: 20px;
            padding: 3px;
            background: linear-gradient(135deg, #a16207 0%, #854d0e 100%);
            border: 2px solid #713f12;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: -5px;
            align-content: end;
        }
        .truck-bed-item {
            font-size: 10px;
        }
        .truck {
            font-size: 40px;
            transform: scaleX(-1);
        }
        .truck-label {
            font-size: 11px;
            font-weight: 500;
            color: #6b7280;
            margin-top: 4px;
        }
        .incoming {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            flex-shrink: 0;
        }
        .raw-materials-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .raw-materials-title {
            font-size: 11px;
            font-weight: 600;
            color: #d97706;
            margin-bottom: 4px;
        }
        .raw-materials {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            min-width: 60px;
            max-height: calc(100vh - 300px);
            overflow: hidden;
            padding: 8px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px dashed #fbbf24;
            border-radius: 10px;
        }
        .raw-materials-count {
            font-size: 10px;
            color: #9ca3af;
            margin-top: 4px;
        }
        .raw-item {
            font-size: 14px;
        }

        /* Compact count display for mobile */
        .compact-count {
            display: none;
            font-size: 14px;
            font-weight: 600;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
        }
        .compact-count.raw {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px dashed #fbbf24;
            color: #92400e;
        }
        .compact-count.finished {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border: 2px dashed #86efac;
            color: #166534;
        }
        .queue-count {
            display: none;
            font-size: 10px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        /* Tablet/mid-size and mobile - two column layout */
        @media (max-width: 1000px) {
            body {
                padding: 12px;
            }
            h1 {
                font-size: 18px;
                margin-bottom: 8px;
            }
            .byline {
                margin: -8px 0 12px 0 !important;
                font-size: 12px !important;
            }
            .controls {
                gap: 8px;
                margin-bottom: 12px;
            }
            #startBtn, #stopBtn {
                font-size: 12px;
                padding: 8px 14px;
            }
            #resetBtn {
                font-size: 11px;
                padding: 6px 12px;
            }
            .timer {
                font-size: 14px;
                padding: 6px 10px;
            }
            .mute-btn {
                font-size: 18px;
                padding: 6px 10px;
            }

            /* Mobile: vertical flow layout */
            .flow-container {
                display: flex;
                flex-direction: column;
                gap: 8px;
                padding: 16px;
                align-items: stretch;
            }

            /* Hide raw materials as separate section - it will be in first worker card */
            .incoming {
                display: none;
            }

            /* Middle: workers in horizontal rows using vertical space */
            .workers-row {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 8px;
                width: 100%;
            }

            /* Bottom row: finished goods - left aligned */
            .done-area {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                gap: 16px;
                margin-top: 8px;
            }
            .done-area .flow-arrow {
                display: block;
                font-size: 18px;
            }

            /* Hide individual boxes, show counts */
            .raw-materials,
            .completed-stack {
                display: none;
            }
            .compact-count {
                display: block;
            }

            /* Workers as horizontal cards */
            .worker-station {
                flex-direction: row;
                align-items: center;
                gap: 12px;
                background: #f8fafc;
                padding: 8px 16px;
                border-radius: 12px;
                width: 90%;
                max-width: 320px;
                justify-content: space-between;
            }
            .worker-station .flow-arrow {
                display: none;
            }
            .queue {
                display: none;
            }
            .queue-count {
                display: block;
                font-size: 13px;
                min-width: 50px;
                text-align: left;
                order: 1;
            }
            .worker {
                order: 2;
                flex-direction: row;
                align-items: center;
                gap: 10px;
            }
            .worker-icon {
                font-size: 36px;
                padding: 6px;
                border-width: 2px;
                border-radius: 10px;
            }
            .worker-info {
                display: flex;
                flex-direction: column;
            }
            .worker-label {
                font-size: 12px;
                margin-top: 0;
            }
            .worker-rate {
                font-size: 11px;
            }

            /* Bottleneck card highlight on mobile */
            .worker-station:has(.worker.bottleneck) {
                background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
                border: 1px solid #fca5a5;
            }

            /* Raw materials in first worker card on mobile */
            .mobile-raw {
                background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                padding: 4px 8px;
                border-radius: 6px;
                border: 1px dashed #fbbf24;
                font-weight: 600;
                color: #92400e;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
            }
            .mobile-raw-label {
                font-size: 8px;
                font-weight: 700;
                color: #b45309;
                letter-spacing: 0.5px;
            }

            /* Compact truck */
            .truck-area {
                transform: scale(0.8);
                transform-origin: top center;
            }
            .truck-with-cargo.driving {
                transform: translateX(150px);
            }

            /* Compact info */
            .raw-materials-title,
            .completed-title {
                font-size: 10px;
            }
            .raw-materials-count {
                display: none;  /* Hide redundant count on mobile */
            }

            /* Better finished area on mobile */
            .done-area {
                margin-top: 8px;
            }
            .truck-area {
                transform: scale(0.9);
            }

            .instructions {
                font-size: 11px;
                margin-top: 10px;
                line-height: 1.4;
            }

            /* Simplify options bar on mobile */
            .options-bar {
                padding: 10px;
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px;
            }
            .costume-picker {
                flex-direction: row;
                gap: 6px;
                font-size: 11px;
                align-items: center;
            }
            .costume-picker > span {
                display: block;
                font-size: 11px;
            }
            .costume-picker .costume-label {
                display: none;
            }
            .costume-btn {
                font-size: 20px;
                padding: 4px 8px;
            }
            #randomizeBtn {
                width: auto;
                font-size: 12px;
                padding: 8px 16px;
            }
        }

        /* Extra small screens (phones in portrait) */
        @media (max-width: 400px) {
            body {
                padding: 8px;
            }
            h1 {
                font-size: 16px;
            }
            .controls {
                gap: 6px;
            }
            #startBtn, #stopBtn {
                font-size: 11px;
                padding: 6px 10px;
            }
            .timer {
                font-size: 12px;
                padding: 5px 8px;
            }
            .worker-icon {
                font-size: clamp(20px, 5vh, 28px);
                padding: clamp(3px, 0.8vh, 6px);
            }
            .instructions {
                font-size: 10px;
            }
        }

        /* Landscape phones - use horizontal layout */
        @media (max-height: 500px) and (max-width: 1000px) {
            body {
                padding: 8px;
            }
            h1 {
                font-size: 16px;
                margin-bottom: 4px;
            }
            .byline {
                margin: -4px 0 8px 0 !important;
                font-size: 10px !important;
            }
            .controls {
                margin-bottom: 8px;
            }
            /* Override mobile vertical layout for landscape */
            .flow-container {
                flex-direction: row;
                flex-wrap: nowrap;
                padding: 8px;
                gap: 6px;
                align-items: flex-start;
            }
            .incoming {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .incoming .flow-arrow {
                display: block;
            }
            .workers-row {
                flex-direction: row;
                gap: 4px;
            }
            .worker-station {
                flex-direction: column;
                background: transparent;
                padding: 4px;
                width: auto;
                max-width: none;
            }
            .queue-count {
                display: none;
            }
            .queue {
                display: none;
            }
            .worker-icon {
                font-size: 24px;
                padding: 4px;
            }
            .worker-label {
                font-size: 8px;
            }
            .worker-rate {
                font-size: 7px;
            }
            .done-area {
                flex-direction: column;
                align-items: center;
            }
            .instructions {
                display: none;
            }
            .options-bar {
                padding: 6px;
                gap: 6px;
            }
            .costume-btn {
                font-size: 16px;
                padding: 2px 4px;
            }
            #randomizeBtn {
                font-size: 10px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <h1>BOTTLENECK SIMULATOR</h1>
    <p class="byline" style="margin: -16px 0 20px 0; font-size: 14px; color: #6b7280;">by <a href="https://clarkeching.com" style="color: #3b82f6; text-decoration: none;">Clarke Ching</a> <span style="color: #d1d5db; font-size: 10px;">v34</span> <button onclick="window.location.reload()" style="background: none; border: none; color: #d1d5db; font-size: 12px; cursor: pointer; padding: 2px 6px;">‚Üª</button></p>

    <div class="controls">
        <button id="startBtn">START DAY 1</button>
        <button id="stopBtn">STOP</button>
        <button id="resetBtn">RESET</button>
        <div class="timer"><span id="timeDisplay">8:00 AM</span></div>
        <button class="mute-btn muted" id="muteBtn" title="Toggle sound">üîá</button>
        <script>
            document.getElementById('muteBtn').onclick = function() {
                var btn = this;
                if (btn.classList.contains('muted')) {
                    btn.textContent = 'üîä';
                    btn.classList.remove('muted');
                    window.isMuted = false;

                    // Create AudioContext on user gesture (required by browsers)
                    if (!window.audioCtx) {
                        window.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    if (window.audioCtx.state === 'suspended') {
                        window.audioCtx.resume();
                    }
                } else {
                    btn.textContent = 'üîá';
                    btn.classList.add('muted');
                    window.isMuted = true;
                }
            };
        </script>
        </div>

    <div class="flow-container">
        <div class="incoming">
            <div class="raw-materials-container">
                <div class="raw-materials-title">RAW MATERIALS</div>
                <div class="raw-materials" id="rawMaterials"></div>
                <div class="compact-count raw" id="rawCompact">üì¶ √ó60</div>
                <div class="raw-materials-count" id="rawCount">75 items</div>
            </div>
            <span class="flow-arrow">‚Üí</span>
        </div>

        <div class="workers-row" id="workers"></div>

        <div class="done-area">
            <span class="flow-arrow">‚Üí</span>
            <div class="completed-container">
                <div class="completed-title">FINISHED</div>
                <div class="completed-stack" id="completedStack"></div>
                <div class="compact-count finished" id="finishedCompact">üì¶ √ó0</div>
            </div>
            <div class="truck-area">
                <div class="truck-with-cargo" id="truckWithCargo">
                    <div class="truck-bed" id="truckBed"></div>
                    <div class="truck" id="truck">üöö</div>
                </div>
                <div class="truck-label">SHIPPING</div>
            </div>
        </div>
    </div>

    <div class="instructions" id="instructions">
        <strong style="color: #ef4444;">üî¥ KEY LESSON:</strong> <span id="bottleneckText">Worker #3 is the BOTTLENECK</span> ‚Äî it has the lowest capacity, so it limits the entire system's output. No matter how fast the other workers are, the system can only produce what the bottleneck can handle.
    </div>

    <div class="options-bar">
        <div class="costume-picker">
            <span>Workplace:</span>
            <div style="display: flex; flex-direction: column; align-items: center;">
                <button class="costume-btn selected" data-costume="0">üë∑‚Äç‚ôÄÔ∏è</button>
                <span class="costume-label">Factory</span>
            </div>
            <div style="display: flex; flex-direction: column; align-items: center;">
                <button class="costume-btn" data-costume="1">üßë‚Äçüíº</button>
                <span class="costume-label">Office</span>
            </div>
            <div style="display: flex; flex-direction: column; align-items: center;">
                <button class="costume-btn" data-costume="2">üë©‚Äçüíª</button>
                <span class="costume-label">Developer</span>
            </div>
        </div>
        <button id="randomizeBtn">üé≤ RANDOMIZE BOTTLENECK</button>
    </div>

    <!-- End of Day Report Modal -->
    <div class="report-overlay" id="reportOverlay">
        <div class="report-modal">
            <div class="report-title" id="reportTitle">üìä END OF DAY REPORT</div>
            <div class="report-section" style="text-align: center; margin: 30px 0;">
                <div class="report-label" style="font-size: 18px;">Items Shipped:</div>
                <div class="report-value good" id="reportCompleted" style="font-size: 48px;">0</div>
            </div>
            <div class="report-insight" id="reportInsight">
                The bottleneck can only do 20 per day, so output = 20.
            </div>
            <button class="report-close" id="reportClose">OK</button>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            SHIFT_DURATION: 21,           // 21 seconds = 1 work day
            STARTING_RAW_MATERIALS: 60,   // Enough for a full day at max capacity
            TICK_RATE: 100,
            START_HOUR: 8,                // 8 AM
            END_HOUR: 17                  // 5 PM (9 hour day in 20 seconds)
        };

        // Worker capacities (items per day) - can be randomized
        let workerCapacities = [60, 60, 20, 60, 60];  // Default: worker 3 is bottleneck at 20/day
        let bottleneckPosition = 2;  // Index of slowest worker

        const COSTUMES = ['üë∑‚Äç‚ôÄÔ∏è', 'üßë‚Äçüíº', 'üë©‚Äçüíª'];

        // Audio context for work sounds
        window.audioCtx = null;
        window.isMuted = true; // Start muted (use window so inline script can access)

        function playWorkSound() {
            if (window.isMuted) return;
            if (!window.audioCtx) {
                window.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            var audioCtx = window.audioCtx;

            // Zelda BOTW cooking-style "clunk" sound
            // Layer 1: Low thump (the "body" of the clunk)
            const thump = audioCtx.createOscillator();
            const thumpGain = audioCtx.createGain();
            thump.connect(thumpGain);
            thumpGain.connect(audioCtx.destination);
            thump.type = 'sine';
            thump.frequency.setValueAtTime(150 + Math.random() * 30, audioCtx.currentTime);
            thump.frequency.exponentialRampToValueAtTime(60, audioCtx.currentTime + 0.08);
            thumpGain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            thumpGain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.12);
            thump.start();
            thump.stop(audioCtx.currentTime + 0.12);

            // Layer 2: High click (the "impact" sound)
            const click = audioCtx.createOscillator();
            const clickGain = audioCtx.createGain();
            click.connect(clickGain);
            clickGain.connect(audioCtx.destination);
            click.type = 'square';
            click.frequency.setValueAtTime(800 + Math.random() * 200, audioCtx.currentTime);
            click.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.03);
            clickGain.gain.setValueAtTime(0.08, audioCtx.currentTime);
            clickGain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.04);
            click.start();
            click.stop(audioCtx.currentTime + 0.04);

            // Layer 3: Noise burst for texture (like wood/material impact)
            const bufferSize = audioCtx.sampleRate * 0.05;
            const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            const noiseGain = audioCtx.createGain();
            const noiseFilter = audioCtx.createBiquadFilter();
            noiseFilter.type = 'bandpass';
            noiseFilter.frequency.value = 1000;
            noiseFilter.Q.value = 1;
            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            noiseGain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
            noise.start();
            noise.stop(audioCtx.currentTime + 0.05);
        }

        function playDingSound() {
            if (window.isMuted) return;
            if (!window.audioCtx) {
                window.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            var audioCtx = window.audioCtx;
            var t = audioCtx.currentTime;

            // High pitched ding
            var osc = audioCtx.createOscillator();
            var gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, t);
            osc.frequency.exponentialRampToValueAtTime(800, t + 0.15);
            gain.gain.setValueAtTime(0.08, t);
            gain.gain.exponentialRampToValueAtTime(0.01, t + 0.2);
            osc.start(t);
            osc.stop(t + 0.2);
        }

        function playTruckSound() {
            if (window.isMuted) return;
            if (!window.audioCtx) {
                window.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            var audioCtx = window.audioCtx;
            var t = audioCtx.currentTime;

            // Layer 1: Deep diesel engine rumble (very low frequency)
            const bassRumble = audioCtx.createOscillator();
            const bassGain = audioCtx.createGain();
            bassRumble.connect(bassGain);
            bassGain.connect(audioCtx.destination);
            bassRumble.type = 'sawtooth';
            bassRumble.frequency.setValueAtTime(35, t);
            bassRumble.frequency.linearRampToValueAtTime(50, t + 0.3);
            bassRumble.frequency.linearRampToValueAtTime(45, t + 1.5);
            bassGain.gain.setValueAtTime(0.12, t);
            bassGain.gain.linearRampToValueAtTime(0.15, t + 0.3);
            bassGain.gain.exponentialRampToValueAtTime(0.01, t + 2.2);
            bassRumble.start(t);
            bassRumble.stop(t + 2.2);

            // Layer 2: Mid-frequency engine chug (the "putt-putt" character)
            const midEngine = audioCtx.createOscillator();
            const midGain = audioCtx.createGain();
            midEngine.connect(midGain);
            midGain.connect(audioCtx.destination);
            midEngine.type = 'square';
            midEngine.frequency.setValueAtTime(70, t);
            midEngine.frequency.linearRampToValueAtTime(100, t + 0.4);
            midEngine.frequency.linearRampToValueAtTime(85, t + 1.5);
            midGain.gain.setValueAtTime(0.04, t);
            midGain.gain.linearRampToValueAtTime(0.06, t + 0.3);
            midGain.gain.exponentialRampToValueAtTime(0.01, t + 2);
            midEngine.start(t);
            midEngine.stop(t + 2);

            // Layer 3: Engine noise texture (filtered noise for that rough diesel sound)
            const noiseLength = audioCtx.sampleRate * 2.5;
            const noiseBuffer = audioCtx.createBuffer(1, noiseLength, audioCtx.sampleRate);
            const noiseData = noiseBuffer.getChannelData(0);
            for (let i = 0; i < noiseLength; i++) {
                noiseData[i] = Math.random() * 2 - 1;
            }
            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            const noiseFilter = audioCtx.createBiquadFilter();
            noiseFilter.type = 'lowpass';
            noiseFilter.frequency.value = 400;
            noiseFilter.Q.value = 2;
            const noiseGain = audioCtx.createGain();
            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            noiseGain.gain.setValueAtTime(0.08, t);
            noiseGain.gain.linearRampToValueAtTime(0.1, t + 0.3);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, t + 2.2);
            noise.start(t);
            noise.stop(t + 2.2);

            // Layer 4: Truck horn - deeper, more "honky" dual-tone
            const horn1 = audioCtx.createOscillator();
            const horn2 = audioCtx.createOscillator();
            const hornGain = audioCtx.createGain();
            horn1.connect(hornGain);
            horn2.connect(hornGain);
            hornGain.connect(audioCtx.destination);
            horn1.type = 'square';
            horn2.type = 'square';
            horn1.frequency.value = 277;  // C#4 - classic truck horn note
            horn2.frequency.value = 349;  // F4 - second note for that truck sound
            hornGain.gain.setValueAtTime(0.08, t);
            hornGain.gain.setValueAtTime(0.08, t + 0.4);
            hornGain.gain.exponentialRampToValueAtTime(0.01, t + 0.5);
            horn1.start(t);
            horn2.start(t);
            horn1.stop(t + 0.5);
            horn2.stop(t + 0.5);

            // Layer 5: Air brake hiss at the start
            const hissLength = audioCtx.sampleRate * 0.3;
            const hissBuffer = audioCtx.createBuffer(1, hissLength, audioCtx.sampleRate);
            const hissData = hissBuffer.getChannelData(0);
            for (let i = 0; i < hissLength; i++) {
                hissData[i] = Math.random() * 2 - 1;
            }
            const hiss = audioCtx.createBufferSource();
            hiss.buffer = hissBuffer;
            const hissFilter = audioCtx.createBiquadFilter();
            hissFilter.type = 'highpass';
            hissFilter.frequency.value = 3000;
            const hissGain = audioCtx.createGain();
            hiss.connect(hissFilter);
            hissFilter.connect(hissGain);
            hissGain.connect(audioCtx.destination);
            hissGain.gain.setValueAtTime(0.15, t);
            hissGain.gain.exponentialRampToValueAtTime(0.01, t + 0.25);
            hiss.start(t);
            hiss.stop(t + 0.3);
        }

        // State
        let workers = [];
        let rawMaterials = CONFIG.STARTING_RAW_MATERIALS;  // Start with materials shown
        let running = false;
        let timeLeft = CONFIG.SHIFT_DURATION;
        let completedCount = 0;
        let completedItems = []; // Track completed items for display
        let currentCostume = 0;
        let gameLoop = null;
        let timerInterval = null;
        let startTime = null;
        let dayNumber = 0;  // Track which day we're on
        let totalCompletedAllDays = 0;  // Track total across all days

        // Calculate process time from capacity (items per day in 20 seconds)
        function getProcessTime(capacity) {
            return Math.floor((20 * 1000) / capacity);  // ms per item
        }

        // Find the bottleneck (worker with lowest capacity)
        function findBottleneck() {
            let minCapacity = workerCapacities[0];
            let minIndex = 0;
            for (let i = 1; i < workerCapacities.length; i++) {
                if (workerCapacities[i] < minCapacity) {
                    minCapacity = workerCapacities[i];
                    minIndex = i;
                }
            }
            bottleneckPosition = minIndex;
            return minIndex;
        }

        // Update the instruction text to reflect current bottleneck
        function updateBottleneckText() {
            const bottleneckCapacity = workerCapacities[bottleneckPosition];
            document.getElementById('bottleneckText').textContent =
                `Worker #${bottleneckPosition + 1} is the BOTTLENECK (only ${bottleneckCapacity}/day)`;
        }

        // Initialize workers
        function initWorkers(isFirstDay = false) {
            findBottleneck();
            workers = [];
            for (let i = 0; i < 5; i++) {
                const worker = {
                    id: i,
                    queue: [],
                    processing: false,
                    processTimeLeft: 0,
                    isBottleneck: i === bottleneckPosition,
                    capacity: workerCapacities[i],
                    completedCount: 0  // Track individual worker output
                };

                // On first day, all workers start with a pile of items in their queue
                // This "primes the pipeline" so the bottleneck can work at full capacity immediately
                // Mark these as "primed" so they don't count toward day 1's shipped total
                if (isFirstDay) {
                    // Give each worker 5 primed items - enough to keep them busy
                    for (let j = 0; j < 5; j++) {
                        worker.queue.push({ primed: true });
                    }
                }

                workers.push(worker);
            }
            updateBottleneckText();
        }

        // Render workers
        function renderWorkers() {
            const container = document.getElementById('workers');
            container.innerHTML = '';

            workers.forEach((worker, index) => {
                const station = document.createElement('div');
                station.className = 'worker-station';

                // Queue count for mobile (shown instead of individual boxes)
                // Worker #1 (index 0) shows raw materials count instead
                const queueCount = document.createElement('div');
                queueCount.className = 'queue-count';
                if (index === 0) {
                    // Worker 1 shows raw materials (styled differently)
                    queueCount.innerHTML = `<span class="mobile-raw"><span class="mobile-raw-label">RAW</span>üì¶√ó${rawMaterials}</span>`;
                } else {
                    // Always show something to maintain alignment (use invisible placeholder when 0)
                    queueCount.innerHTML = worker.queue.length > 0 ? `üì¶√ó${worker.queue.length}` : '&nbsp;&nbsp;&nbsp;&nbsp;';
                }
                station.appendChild(queueCount);

                // Queue to the LEFT of worker (grows downward) - hidden on mobile
                const queueDiv = document.createElement('div');
                queueDiv.className = 'queue';
                queueDiv.innerHTML = worker.queue.map(() => '<span class="queue-item">üì¶</span>').join('');
                station.appendChild(queueDiv);

                // Worker
                const workerDiv = document.createElement('div');
                workerDiv.className = 'worker' +
                    (worker.processing ? ' processing' : '') +
                    (worker.isBottleneck ? ' bottleneck' : '');

                workerDiv.innerHTML = `
                    <div class="worker-icon">${COSTUMES[currentCostume]}</div>
                    <div class="worker-label">${worker.isBottleneck ? 'SLOW!' : '#' + (index + 1)}</div>
                    <div class="worker-rate">${worker.capacity}/day</div>
                `;
                station.appendChild(workerDiv);

                // Arrow to next worker
                if (index < workers.length - 1) {
                    const arrow = document.createElement('span');
                    arrow.className = 'flow-arrow';
                    arrow.style.paddingTop = '0';
                    arrow.style.marginLeft = '5px';
                    arrow.textContent = '‚Üí';
                    station.appendChild(arrow);
                }

                container.appendChild(station);
            });
        }

        // Convert timeLeft to clock time
        function getClockTime(secondsLeft) {
            const totalMinutes = CONFIG.END_HOUR * 60 - CONFIG.START_HOUR * 60; // 540 minutes in work day
            const elapsedRatio = 1 - (secondsLeft / CONFIG.SHIFT_DURATION);
            const elapsedMinutes = Math.floor(elapsedRatio * totalMinutes);
            const currentMinutes = CONFIG.START_HOUR * 60 + elapsedMinutes;
            const hours = Math.floor(currentMinutes / 60);
            const mins = currentMinutes % 60;
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours > 12 ? hours - 12 : hours;
            return `${displayHours}:${mins.toString().padStart(2, '0')} ${ampm}`;
        }

        // Update stats display
        function updateStats() {
            document.getElementById('timeDisplay').textContent = getClockTime(timeLeft);
        }

        // Process one tick
        function tick() {
            // Feed worker 1 from raw materials if their queue is empty
            if (workers[0].queue.length === 0 && rawMaterials > 0) {
                rawMaterials--;
                workers[0].queue.push({});
                renderRawMaterials();
            }

            workers.forEach((worker, index) => {
                if (!worker.processing && worker.queue.length > 0) {
                    worker.processing = true;
                    worker.processTimeLeft = getProcessTime(worker.capacity);
                }

                if (worker.processing) {
                    worker.processTimeLeft -= CONFIG.TICK_RATE;

                    if (worker.processTimeLeft <= 0) {
                        worker.processing = false;
                        const item = worker.queue.shift();
                        worker.completedCount++;  // Track this worker's output
                        playWorkSound();

                        if (index < workers.length - 1) {
                            // Pass the item (with primed flag if it has one) to next worker
                            workers[index + 1].queue.push(item);
                        } else {
                            // Only count non-primed items as shipped
                            if (!item.primed) {
                                completedCount++;
                                completedItems.push({});
                                playDingSound();
                            }
                            renderCompletedStack();
                        }
                    }
                }
            });

            renderWorkers();
            updateStats();
        }

        // Render completed items stack
        function renderCompletedStack() {
            const stack = document.getElementById('completedStack');
            stack.innerHTML = completedItems.map(() => '<span class="completed-item">üì¶</span>').join('');
            // Update compact display for mobile
            document.getElementById('finishedCompact').textContent = `üì¶ √ó${completedItems.length}`;
        }

        // Render raw materials pile
        function renderRawMaterials() {
            const pile = document.getElementById('rawMaterials');
            const countLabel = document.getElementById('rawCount');
            let html = '';
            for (let i = 0; i < rawMaterials; i++) {
                html += '<span class="raw-item">üì¶</span>';
            }
            pile.innerHTML = html;
            countLabel.textContent = rawMaterials + ' items';
            // Update compact display for mobile
            document.getElementById('rawCompact').textContent = `üì¶ √ó${rawMaterials}`;
        }

        // Load truck and drive away
        function loadTruckAndDrive() {
            const truckWithCargo = document.getElementById('truckWithCargo');
            const truckBed = document.getElementById('truckBed');
            const stack = document.getElementById('completedStack');

            // Animate loading boxes one by one onto truck bed
            let loadIndex = 0;
            const loadInterval = setInterval(() => {
                if (loadIndex < completedItems.length) {
                    truckBed.innerHTML += '<span class="truck-bed-item">üì¶</span>';
                    loadIndex++;
                } else {
                    clearInterval(loadInterval);
                    // Clear the finished stack (desktop and mobile)
                    stack.innerHTML = '';
                    completedItems = [];
                    document.getElementById('finishedCompact').textContent = 'üì¶ √ó0';
                    // Drive away after loading complete
                    setTimeout(() => {
                        playTruckSound();
                        truckWithCargo.classList.add('driving');
                    }, 300);
                }
            }, 50); // Load each box quickly
        }

        // Reset truck position
        function resetTruck() {
            const truckWithCargo = document.getElementById('truckWithCargo');
            const truckBed = document.getElementById('truckBed');
            truckWithCargo.classList.remove('driving');
            truckBed.innerHTML = '';
        }

        // Show end of day report
        function showReport() {
            const bottleneckCapacity = workerCapacities[bottleneckPosition];
            document.getElementById('reportTitle').textContent = `üìä END OF DAY ${dayNumber} REPORT`;
            document.getElementById('reportCompleted').textContent = bottleneckCapacity;

            // Simple insight message
            const insight = document.getElementById('reportInsight');
            insight.innerHTML = `
                <strong>üí° Key Insight:</strong> Worker #${bottleneckPosition + 1} (the bottleneck) can only do <strong>${bottleneckCapacity} per day</strong>,
                so output = <strong>${bottleneckCapacity}</strong>.
            `;

            document.getElementById('reportOverlay').classList.add('visible');
        }

        // Hide report
        function hideReport() {
            document.getElementById('reportOverlay').classList.remove('visible');
        }

        // Start simulation
        function start() {
            if (running) return;

            running = true;
            dayNumber++;
            timeLeft = CONFIG.SHIFT_DURATION;

            // Reset daily counts but keep workers' queue state (WIP carries over)
            completedCount = 0;
            completedItems = [];

            // Replenish raw materials for the new day
            rawMaterials = CONFIG.STARTING_RAW_MATERIALS;
            startTime = Date.now();

            // Only initialize workers fresh on day 1
            if (dayNumber === 1) {
                initWorkers(true);  // true = first day, add starting inventory
            } else {
                // For subsequent days, reset daily completion counts but keep queues
                workers.forEach(w => {
                    w.completedCount = 0;
                    w.processing = false;
                    w.processTimeLeft = 0;
                });
            }

            renderWorkers();
            renderCompletedStack();
            renderRawMaterials();
            resetTruck();
            updateStats();

            document.getElementById('startBtn').disabled = true;
            document.getElementById('startBtn').textContent = `RUNNING DAY ${dayNumber}...`;
            document.getElementById('stopBtn').classList.add('visible');
            document.getElementById('randomizeBtn').disabled = true;

            gameLoop = setInterval(tick, CONFIG.TICK_RATE);

            timerInterval = setInterval(() => {
                timeLeft--;
                updateStats();

                if (timeLeft <= 0) {
                    stop(true); // End of day - show truck and report
                }
            }, 1000);
        }

        // Stop simulation (endOfDay=true shows truck and report, false just stops)
        function stop(endOfDay) {
            running = false;
            clearInterval(gameLoop);
            clearInterval(timerInterval);

            // Add today's output to the running total
            if (endOfDay) {
                totalCompletedAllDays += completedCount;
            }

            document.getElementById('startBtn').disabled = false;
            document.getElementById('startBtn').textContent = `START DAY ${dayNumber + 1}`;
            document.getElementById('stopBtn').classList.remove('visible');
            document.getElementById('randomizeBtn').disabled = false;

            renderWorkers();
            updateStats();

            if (endOfDay) {
                // Load up the truck and drive away!
                loadTruckAndDrive();

                // Show report after truck drives away (wait for loading + driving animation)
                const loadTime = completedItems.length * 50 + 300; // 50ms per item + 300ms pause
                const driveTime = 1500; // truck drive animation duration
                setTimeout(showReport, loadTime + driveTime + 500);
            }
        }

        // Costume picker
        document.querySelectorAll('.costume-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.costume-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                currentCostume = parseInt(btn.dataset.costume);
                renderWorkers();
            });
        });

        // Cycle costume (for mobile tap on workers)
        function cycleCostume() {
            currentCostume = (currentCostume + 1) % COSTUMES.length;
            // Update desktop buttons too
            document.querySelectorAll('.costume-btn').forEach(b => b.classList.remove('selected'));
            document.querySelector(`.costume-btn[data-costume="${currentCostume}"]`).classList.add('selected');
            renderWorkers();
        }

        // Make workers tappable on mobile to change costume
        document.getElementById('workers').addEventListener('click', function(e) {
            if (window.innerWidth <= 768 && e.target.closest('.worker-icon')) {
                cycleCostume();
            }
        });

        // Full reset to day 1
        function fullReset() {
            dayNumber = 0;
            totalCompletedAllDays = 0;
            completedCount = 0;
            completedItems = [];
            rawMaterials = CONFIG.STARTING_RAW_MATERIALS;
            initWorkers(true);  // First day with starting inventory
            renderWorkers();
            renderCompletedStack();
            renderRawMaterials();
            resetTruck();
            document.getElementById('startBtn').textContent = 'START DAY 1';
            updateStats();
        }

        // Randomize capacities between 30 and 60 for all workers
        function randomizeCapacities() {
            if (running) return;  // Don't randomize while running

            // Generate random capacities between 30 and 60
            workerCapacities = [];
            for (let i = 0; i < 5; i++) {
                workerCapacities.push(Math.floor(Math.random() * 31) + 30);  // 30-60
            }

            // Full reset with new capacities
            dayNumber = 0;
            totalCompletedAllDays = 0;
            completedCount = 0;
            completedItems = [];
            rawMaterials = CONFIG.STARTING_RAW_MATERIALS;
            initWorkers(true);
            renderWorkers();
            renderCompletedStack();
            renderRawMaterials();
            resetTruck();
            document.getElementById('startBtn').textContent = 'START DAY 1';
            updateStats();
        }

        // Initialize
        initWorkers(true);  // First day with starting inventory
        renderWorkers();
        renderRawMaterials();  // Show raw materials on page load
        dayNumber = 0;  // Will become 1 when start is clicked
        updateStats();

        document.getElementById('startBtn').addEventListener('click', start);
        document.getElementById('stopBtn').addEventListener('click', function() { stop(false); });
        document.getElementById('resetBtn').addEventListener('click', fullReset);
        document.getElementById('randomizeBtn').addEventListener('click', randomizeCapacities);
        document.getElementById('reportClose').addEventListener('click', hideReport);

        // Auto-refresh when PWA resumes from background
        const CURRENT_VERSION = 'v34';
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // Check if there's a newer version available
                fetch(window.location.href + '?_=' + Date.now())
                    .then(response => response.text())
                    .then(html => {
                        const match = html.match(/v(\d+)<\/span>/);
                        if (match) {
                            const remoteVersion = 'v' + match[1];
                            if (remoteVersion !== CURRENT_VERSION) {
                                window.location.reload();
                            }
                        }
                    })
                    .catch(() => {});  // Silently fail if offline
            }
        });
    </script>
</body>
</html>
